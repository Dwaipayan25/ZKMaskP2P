'use strict';

var ae = require('gzip-js');
var ce = require('tar-js');
var K = require('axios');
var zod = require('zod');
var se = require('pino');

function _interopDefault (e) { return e && e.__esModule ? e : { default: e }; }

var ae__default = /*#__PURE__*/_interopDefault(ae);
var ce__default = /*#__PURE__*/_interopDefault(ce);
var K__default = /*#__PURE__*/_interopDefault(K);
var se__default = /*#__PURE__*/_interopDefault(se);

var E=class{constructor(e){this.config=e;}};var P=window.File,C=window.FormData;var T=class extends Error{url;status;statusText;body;request;constructor(e,r,i){super(i),this.name="ApiError",this.url=r.url,this.status=r.status,this.statusText=r.statusText,this.body=r.body,this.request=e;}};var _=class extends Error{constructor(e){super(e),this.name="CancelError";}get isCancelled(){return !0}},A=class{#t;#r;#e;#o;#i;#n;#s;constructor(e){this.#t=!1,this.#r=!1,this.#e=!1,this.#o=[],this.#i=new Promise((r,i)=>{this.#n=r,this.#s=i;let o=c=>{this.#t||this.#r||this.#e||(this.#t=!0,this.#n?.(c));},s=c=>{this.#t||this.#r||this.#e||(this.#r=!0,this.#s?.(c));},a=c=>{this.#t||this.#r||this.#e||this.#o.push(c);};return Object.defineProperty(a,"isResolved",{get:()=>this.#t}),Object.defineProperty(a,"isRejected",{get:()=>this.#r}),Object.defineProperty(a,"isCancelled",{get:()=>this.#e}),e(o,s,a)});}get[Symbol.toStringTag](){return "Cancellable Promise"}then(e,r){return this.#i.then(e,r)}catch(e){return this.#i.catch(e)}finally(e){return this.#i.finally(e)}cancel(){if(!(this.#t||this.#r||this.#e)){if(this.#e=!0,this.#o.length)try{for(let e of this.#o)e();}catch(e){console.warn("Cancellation threw an error",e);return}this.#o.length=0,this.#s?.(new _("Request aborted"));}}get isCancelled(){return this.#e}};var H=t=>t!=null,N=t=>typeof t=="string",L=t=>N(t)&&t!=="",z=t=>typeof t=="object"&&typeof t.type=="string"&&typeof t.stream=="function"&&typeof t.arrayBuffer=="function"&&typeof t.constructor=="function"&&typeof t.constructor.name=="string"&&/^(Blob|File)$/.test(t.constructor.name)&&/^(Blob|File)$/.test(t[Symbol.toStringTag]),V=t=>t instanceof C,M=t=>t>=200&&t<300,J=t=>{try{return btoa(t)}catch{return Buffer.from(t).toString("base64")}},G=t=>{let e=[],r=(o,s)=>{e.push(`${encodeURIComponent(o)}=${encodeURIComponent(String(s))}`);},i=(o,s)=>{H(s)&&(Array.isArray(s)?s.forEach(a=>{i(o,a);}):typeof s=="object"?Object.entries(s).forEach(([a,c])=>{i(`${o}[${a}]`,c);}):r(o,s));};return Object.entries(t).forEach(([o,s])=>{i(o,s);}),e.length>0?`?${e.join("&")}`:""},Q=(t,e)=>{let r=t.ENCODE_PATH||encodeURI,i=e.url.replace("{api-version}",t.VERSION).replace(/{(.*?)}/g,(s,a)=>e.path?.hasOwnProperty(a)?r(String(e.path[a])):s),o=`${t.BASE}${i}`;return e.query?`${o}${G(e.query)}`:o},X=t=>{if(t.formData){if(t.formData instanceof C)return t.formData;let e=new C,r=(i,o)=>{N(o)||z(o)?e.append(i,o):e.append(i,JSON.stringify(o));};return Object.entries(t.formData).filter(([i,o])=>H(o)).forEach(([i,o])=>{Array.isArray(o)?o.forEach(s=>r(i,s)):r(i,o);}),e}},D=async(t,e)=>typeof e=="function"?e(t):e,Y=async(t,e,r)=>{let i=await D(e,t.TOKEN),o=await D(e,t.USERNAME),s=await D(e,t.PASSWORD),a=await D(e,t.HEADERS),c=r&&"getHeaders"in r&&typeof r?.getHeaders=="function"&&r?.getHeaders()||{},u=Object.entries({Accept:"application/json",...a,...e.headers,...c}).filter(([p,n])=>H(n)).reduce((p,[n,l])=>({...p,[n]:String(l)}),{});if(L(i)&&(u.Authorization=`Bearer ${i}`),L(o)&&L(s)){let p=J(`${o}:${s}`);u.Authorization=`Basic ${p}`;}return e.body&&(e.mediaType?u["Content-Type"]=e.mediaType:z(e.body)?u["Content-Type"]=e.body.type||"application/octet-stream":N(e.body)?u["Content-Type"]="text/plain":V(e.body)||(u["Content-Type"]="application/json")),u},Z=t=>{if(t.body)return t.body},ee=async(t,e,r,i,o,s,a,c)=>{let u=K__default.default.CancelToken.source(),p={url:r,headers:s,data:i??o,method:e.method,withCredentials:t.WITH_CREDENTIALS,cancelToken:u.token,responseType:e.responseType};a(()=>u.cancel("The user aborted a request."));try{return await c.request(p)}catch(n){let l=n;if(l.response)return l.response;throw n}},te=(t,e)=>{if(e){let r=t.headers[e];if(N(r))return r}},re=t=>{if(t.status!==204)return t.data},oe=(t,e)=>{let i={400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable",...t.errors}[e.status];if(i)throw new T(t,e,i);if(!e.ok){let o=e.status??"unknown",s=e.statusText??"unknown",a=(()=>{try{return JSON.stringify(e.body,null,2)}catch{return}})();throw new T(t,e,`Generic Error: status: ${o}; status text: ${s}; body: ${a}`)}},W=(t,e,r=K__default.default)=>new A(async(i,o,s)=>{let a=Date.now(),c=()=>{let n=Date.now()-a;if(n<1e3)return `${n} ms`;let l=n/1e3;if(l<60)return `${l.toFixed(2)} s`;let y=l/60;return y<60?`${y.toFixed(2)} m`:`${(y/60).toFixed(2)} h`},u=Q(t,e),p=`${e.method} ${u}`;try{let n=X(e),l=Z(e),y=await Y(t,e,n);if(!s.isCancelled){t.logger?.debug(`${p} requested`);let f=await ee(t,e,u,l,n,y,s,r),R=re(f),d=te(f,e.responseHeader),h={url:u,ok:M(f.status),status:f.status,statusText:f.statusText,body:d??R},b=`${p} ${f.status} ${f.statusText} (${c()})`;!h.body||typeof h.body=="string"?t.logger?.debug(`${b} - ${h.body||"<empty-body>"}`):e.responseType==="stream"?t.logger?.debug(`${b} - <streaming-response>`):e.responseType==="blob"?t.logger?.debug(`${b} - <blob-response>`):t.logger?.debug(h.body,b),oe(e,h),i(h.body);}}catch(n){let l=n instanceof Error?n.message:"Unknown error";t.logger?.debug(`${p} ERROR (${c()}) - ${l}`),o(n);}});var F=class extends E{constructor(e){super(e);}request(e){return W(this.config,e)}};var I=class{constructor(e){this.httpRequest=e;}apikeyGenerate(e){return this.httpRequest.request({method:"POST",url:"/api/apikey/generate",body:e,mediaType:"application/json",errors:{401:"Unauthorized",412:"Precondition Failed"}})}apikeyGenerateWithAuth(e){return this.httpRequest.request({method:"POST",url:"/api/v1/apikey/generate",query:{name:e},errors:{412:"Precondition Failed"}})}apikeyList(){return this.httpRequest.request({method:"GET",url:"/api/v1/apikey/list",errors:{500:"Internal Server Error"}})}apikeyDelete(e){return this.httpRequest.request({method:"DELETE",url:"/api/v1/apikey/{apikey_id}/delete",path:{apikey_id:e},errors:{404:"Not Found",500:"Internal Server Error"}})}};var O=class{constructor(e){this.httpRequest=e;}circuitCreate(e){return this.httpRequest.request({method:"POST",url:"/api/v1/circuit/create",formData:e,mediaType:"multipart/form-data",errors:{412:"Precondition Failed",422:"Unprocessable Entity",500:"Internal Server Error",501:"Not Implemented"}})}circuitList(){return this.httpRequest.request({method:"GET",url:"/api/v1/circuit/list",errors:{500:"Internal Server Error"}})}circuitDetail(e,r=!0){return this.httpRequest.request({method:"GET",url:"/api/v1/circuit/{circuit_id}/detail",path:{circuit_id:e},query:{include_verification_key:r},errors:{404:"Not Found",500:"Internal Server Error"}})}circuitDelete(e){return this.httpRequest.request({method:"DELETE",url:"/api/v1/circuit/{circuit_id}/delete",path:{circuit_id:e},errors:{404:"Not Found",500:"Internal Server Error"}})}circuitProofs(e){return this.httpRequest.request({method:"GET",url:"/api/v1/circuit/{circuit_id}/proofs",path:{circuit_id:e},errors:{404:"Not Found",500:"Internal Server Error"}})}proofCreate(e,r){return this.httpRequest.request({method:"POST",url:"/api/v1/circuit/{circuit_id}/prove",path:{circuit_id:e},formData:r,mediaType:"application/x-www-form-urlencoded",errors:{404:"Not Found",412:"Precondition Failed",501:"Not Implemented"}})}};var x=class{constructor(e){this.httpRequest=e;}circuitDownload(e){return this.httpRequest.request({method:"GET",url:"/api/v1/circuit/{circuit_id}/download",path:{circuit_id:e},errors:{404:"Not Found",500:"Internal Server Error"},responseType:"blob"})}circuitSmartContractVerifier(e){return this.httpRequest.request({method:"GET",url:"/api/v1/circuit/{circuit_id}/smart_contract_verifier",path:{circuit_id:e},errors:{404:"Not Found",412:"Precondition Failed",500:"Internal Server Error",501:"Not Implemented"}})}passwordChangeWithJwtAuth(e){return this.httpRequest.request({method:"POST",url:"/api/v1/password/change",formData:e,mediaType:"application/x-www-form-urlencoded",errors:{422:"Unprocessable Entity"}})}proofList(){return this.httpRequest.request({method:"GET",url:"/api/v1/proof/list",errors:{500:"Internal Server Error"}})}sindriManifestSchema(){return this.httpRequest.request({method:"GET",url:"/api/v1/sindri-manifest-schema.json"})}teamMe(){return this.httpRequest.request({method:"GET",url:"/api/v1/team/me"})}userMeWithJwtAuth(){return this.httpRequest.request({method:"GET",url:"/api/v1/user/me"})}};var w=class{constructor(e){this.httpRequest=e;}proofDetail(e,r=!0,i=!0,o=!1,s=!0){return this.httpRequest.request({method:"GET",url:"/api/v1/proof/{proof_id}/detail",path:{proof_id:e},query:{include_proof:r,include_public:i,include_smart_contract_calldata:o,include_verification_key:s},errors:{404:"Not Found",500:"Internal Server Error",501:"Not Implemented"}})}proofDelete(e){return this.httpRequest.request({method:"DELETE",url:"/api/v1/proof/{proof_id}/delete",path:{proof_id:e},errors:{404:"Not Found",500:"Internal Server Error"}})}};var q=class{constructor(e){this.httpRequest=e;}fd3Aaa7BControllerObtainToken(e){return this.httpRequest.request({method:"POST",url:"/api/token/pair",body:e,mediaType:"application/json"})}b87E0720ControllerRefreshToken(e){return this.httpRequest.request({method:"POST",url:"/api/token/refresh",body:e,mediaType:"application/json"})}d1C092ControllerVerifyToken(e){return this.httpRequest.request({method:"POST",url:"/api/token/verify",body:e,mediaType:"application/json"})}};var v=class{authorization;circuits;internal;proofs;token;request;constructor(e,r=F){this.request=new r({BASE:e?.BASE??"https://sindri.app",VERSION:e?.VERSION??"1.6.14",WITH_CREDENTIALS:e?.WITH_CREDENTIALS??!1,CREDENTIALS:e?.CREDENTIALS??"include",TOKEN:e?.TOKEN,USERNAME:e?.USERNAME,PASSWORD:e?.PASSWORD,HEADERS:e?.HEADERS,ENCODE_PATH:e?.ENCODE_PATH}),this.authorization=new I(this.request),this.circuits=new O(this.request),this.internal=new x(this.request),this.proofs=new w(this.request),this.token=new q(this.request);}};var ie=zod.z.object({auth:zod.z.nullable(zod.z.object({apiKey:zod.z.string(),apiKeyId:zod.z.string(),apiKeyName:zod.z.string(),baseUrl:zod.z.string().url(),teamId:zod.z.number(),teamSlug:zod.z.string()})).default(null)});ie.parse({});var $=t=>{let e=se__default.default({browser:{asObject:!0}});return e.level=t??!0?"silent":"info",e};$();var k=class t{_client;_clientConfig;_config;logger;pollingInterval=1e3;constructor(e={}){this._client=new v,this._clientConfig=this._client.request.config;let r="v0.0.1-alpha.44";this._clientConfig.HEADERS={...this._clientConfig.HEADERS,"Sindri-Client":`sindri-js-sdk/${r}`},this.logger=$(),this._clientConfig.logger=this.logger,this.authorize(e);}get apiKey(){return this._clientConfig.TOKEN&&typeof this._clientConfig.TOKEN!="string"?null:this._clientConfig.TOKEN||null}get baseUrl(){return this._clientConfig.BASE}get logLevel(){return this.logger.level}set logLevel(e){this.logger.level=e,this.logger.debug(`Set log level to "${this.logger.level}".`);}authorize(e){return this._clientConfig.BASE=e.baseUrl||"https://sindri.app",this._clientConfig.TOKEN=e.apiKey,!!(this._clientConfig.BASE&&this._clientConfig.TOKEN)}create(e){return new t(e)}async createCircuit(e,r=["latest"]){let i=new C;r=typeof r=="string"?[r]:r??[];for(let p of r){if(!/^[-a-zA-Z0-9_.]+$/.test(p))throw new Error(`"${p}" is not a valid tag. Tags may only contain alphanumeric characters, underscores, hyphens, and periods.`);i.append("tags",p);}if(r.length===0&&i.append("tags",""),typeof e=="string"){throw new Error("Specifying `project` as a path is not allowed in the browser build.");}else if(Array.isArray(e)){if(!e.every(d=>d instanceof P))throw new Error("All entries in `project` must be `File` instances.");let p=e.find(d=>d.name==="sindri.json");if(!p)throw new Error("The `project` array must include a `sindri.json` file.");let n;try{n=JSON.parse(await p.text());}catch{throw new Error('Could not parse "sindri.json", is it valid JSON?')}let l=n?.name;if(!l)throw new Error('No circuit "name" field was found in "sindri.json", the manifest is invalid.');let y=new ce__default.default;e.sort((d,h)=>d.name.localeCompare(h.name));for(let d of e){let h=new Uint8Array(await d.arrayBuffer());await new Promise(b=>y.append(`${l}/${d.name}`,h,b));}let f=new Uint8Array(ae__default.default.zip(y.out)),R=new P([f],`${l}.tar.gz`);i.append("files",R);}let o=this._clientConfig.HEADERS;this._clientConfig.HEADERS={...o,"Content-Type":"multipart/form-data; boundary=----WebKitFormBoundary0buQ8d6EhWcs9X9d"};let a=await this._client.circuits.circuitCreate(i);this._clientConfig.HEADERS=o;let c=a.circuit_id,u;for(;u=await this._client.circuits.circuitDetail(c,!1),!(u.status==="Ready"||u.status==="Failed");)await new Promise(p=>setTimeout(p,this.pollingInterval));return u}async getAllCircuitProofs(e){return await this._client.circuits.circuitProofs(e)}async getAllCircuits(){return await this._client.circuits.circuitList()}async getCircuit(e){return await this._client.circuits.circuitDetail(e)}async getProof(e){return await this._client.proofs.proofDetail(e)}async proveCircuit(e,r,i=!1,o=!1){let s=await this._client.circuits.proofCreate(e,{perform_verify:i,proof_input:r}),a;for(;a=await this._client.proofs.proofDetail(s.proof_id,!0,!0,o,!0),!(a.status==="Ready"||a.status==="Failed");)await new Promise(c=>setTimeout(c,this.pollingInterval));return a}};var Ut=new k;

module.exports = Ut;
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.js.map